<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêç JUDY Snake Adventure üêç</title>
  <style>
    body {
      background: #0a0a0a;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: white;
      font-family: "Press Start 2P", monospace;
      text-align: center;
    }
    canvas {
      border: 3px solid #44ff66;
      background: #111;
      image-rendering: pixelated;
      display: none;
    }
    h1 {
      color: #00ff88;
      text-shadow: 2px 2px #003300;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .scoreboard {
      display: none;
      color: #ff88aa;
      font-size: 12px;
      margin-bottom: 10px;
    }
    .controls, .menu {
      margin-top: 15px;
    }
    button {
      background: #222;
      color: #00ffcc;
      border: 2px solid #00ffcc;
      font-size: 12px;
      margin: 5px;
      padding: 8px 14px;
      border-radius: 6px;
      font-family: "Press Start 2P", monospace;
      cursor: pointer;
    }
    button:hover {
      background: #00ffcc;
      color: #111;
    }
    footer {
      margin-top: 10px;
      color: #777;
      font-size: 10px;
    }
  </style>
</head>
<body>
  <h1>üêç JUDY ANN FAITH CASTILLO üêç</h1>

  <!-- Stage Selection Menu -->
  <div class="menu" id="menu">
    <p>Select Stage:</p>
    <div id="stageButtons"></div>
    <br>
    <button onclick="continueLast()">‚ñ∂Ô∏è Continue Last Stage</button>
    <button onclick="resetProgress()">üóëÔ∏è Reset Progress</button>
  </div>

  <!-- Scoreboard + Game -->
  <div class="scoreboard" id="scoreboard">STAGE: <span id="stage">1</span> | SCORE: <span id="score">0</span></div>
  <canvas id="gameCanvas" width="320" height="320"></canvas>

  <div class="controls" id="controls" style="display:none;">
    <button onclick="changeDirection('UP')">‚¨ÜÔ∏è</button><br>
    <button onclick="changeDirection('LEFT')">‚¨ÖÔ∏è</button>
    <button onclick="togglePause()">‚èØÔ∏è</button>
    <button onclick="changeDirection('RIGHT')">‚û°Ô∏è</button><br>
    <button onclick="changeDirection('DOWN')">‚¨áÔ∏è</button>
  </div>

  <footer>Made with ‚ù§Ô∏è by Arielle & JUDY</footer>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreboard = document.getElementById("scoreboard");
    const stageButtonsDiv = document.getElementById("stageButtons");

    const box = 16;
    let snake, direction, food, score, stage, speed, paused;
    let bossSnake = null;
    let bossDirection = "LEFT";
    let game;

    // Load saved progress (default 1 if no save found)
    let unlockedStages = parseInt(localStorage.getItem("snakeUnlockedStages")) || 1;

    // üéµ Friendly sound
    function playTone(freq, duration = 0.2, type = "sine", volume = 0.08) {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      gain.gain.value = volume;
      osc.start();
      osc.stop(audioCtx.currentTime + duration);
    }

    function drawBackground() {
      for (let y = 0; y < 20; y++) {
        for (let x = 0; x < 20; x++) {
          ctx.fillStyle = (x + y) % 2 === 0 ? "#0f3d0f" : "#145214";
          ctx.fillRect(x * box, y * box, box, box);
        }
      }
    }

    function randomFood() {
      return {
        x: Math.floor(Math.random() * 19 + 1) * box,
        y: Math.floor(Math.random() * 19 + 1) * box
      };
    }

    function collision(newHead, arr) {
      return arr.some(seg => seg.x === newHead.x && seg.y === newHead.y);
    }

    function moveBoss() {
      if (!bossSnake) return;
      let headX = bossSnake[0].x;
      let headY = bossSnake[0].y;
      if (bossDirection === "LEFT") headX -= box;
      if (bossDirection === "UP") headY -= box;
      if (bossDirection === "RIGHT") headX += box;
      if (bossDirection === "DOWN") headY += box;
      if (Math.random() < 0.1) {
        const dirs = ["LEFT","RIGHT","UP","DOWN"];
        bossDirection = dirs[Math.floor(Math.random()*dirs.length)];
      }
      if (headX < 0) headX = 304;
      if (headX >= 320) headX = 0;
      if (headY < 0) headY = 304;
      if (headY >= 320) headY = 0;
      bossSnake.pop();
      bossSnake.unshift({ x: headX, y: headY });
    }

    function drawSnakePart(x, y, head=false) {
      ctx.fillStyle = head ? "#33ff77" : "#55ff99";
      ctx.fillRect(x, y, box, box);
      if (head) {
        ctx.fillStyle = "#000";
        ctx.fillRect(x+4, y+4, 3,3);
        ctx.fillRect(x+9, y+4, 3,3);
      }
    }

    function draw() {
      if (paused) {
        ctx.fillStyle = "#111";
        ctx.fillRect(0,0,320,320);
        ctx.fillStyle = "#ffcc00";
        ctx.font = "12px 'Press Start 2P'";
        ctx.fillText("PAUSED",100,160);
        return;
      }

      drawBackground();

      // Food
      ctx.fillStyle = stage === 6 ? "#ffff00" : "#ff4444";
      ctx.fillRect(food.x, food.y, box, box);

      // Snake
      for (let i=0; i<snake.length; i++) {
        drawSnakePart(snake[i].x, snake[i].y, i===0);
      }

      // Boss Snake
      if (stage === 6 && bossSnake) {
        for (let i=0; i<bossSnake.length; i++) {
          ctx.fillStyle = i===0 ? "#ff00ff" : "#cc00cc";
          ctx.fillRect(bossSnake[i].x, bossSnake[i].y, box, box);
        }
        moveBoss();
        for (let part of bossSnake) {
          if (snake[0].x === part.x && snake[0].y === part.y) {
            clearInterval(game);
            playTone(180,0.5,"sine",0.07);
            alert("üíÄ JUDY was eaten by the Final Boss!");
            returnToMenu();
          }
        }
      }

      // Snake move
      let snakeX = snake[0].x;
      let snakeY = snake[0].y;
      if (direction==="LEFT") snakeX -= box;
      if (direction==="UP") snakeY -= box;
      if (direction==="RIGHT") snakeX += box;
      if (direction==="DOWN") snakeY += box;

      if (snakeX === food.x && snakeY === food.y) {
        score++;
        playTone(660,0.15,"sine",0.05);
        document.getElementById("score").innerText = score;
        food = randomFood();

        // Win condition = 10 points per stage
        if (score >= 10) {
          clearInterval(game);
          playTone(880,0.3,"triangle",0.06);
          alert(`üéâ Stage ${stage} cleared!`);
          if (stage < 6) {
            unlockedStages = Math.max(unlockedStages, stage+1);
            localStorage.setItem("snakeUnlockedStages", unlockedStages); // üîí Save progress
          }
          returnToMenu();
        }

      } else {
        snake.pop();
      }

      let newHead = { x: snakeX, y: snakeY };
      if (snakeX < 0 || snakeX>=320 || snakeY<0 || snakeY>=320 || collision(newHead,snake)) {
        clearInterval(game);
        playTone(220,0.5,"sine",0.07);
        alert("üíî JUDY crashed!");
        returnToMenu();
      }
      snake.unshift(newHead);
    }

    function startStage(selectedStage) {
      stage = selectedStage;
      snake = [{ x: 9*box, y: 10*box }];
      direction = "RIGHT";
      score = 0;
      paused = false;
      speed = 200 - (stage-1)*25;
      if (stage===6) {
        bossSnake = [
          {x:5*box,y:5*box},{x:6*box,y:5*box},
          {x:7*box,y:5*box},{x:8*box,y:5*box}
        ];
      } else {
        bossSnake = null;
      }

      document.getElementById("stage").innerText = stage;
      document.getElementById("score").innerText = score;
      scoreboard.style.display = "block";
      canvas.style.display = "block";
      document.getElementById("controls").style.display = "block";
      document.getElementById("menu").style.display = "none";
      food = randomFood();

      clearInterval(game);
      game = setInterval(draw, speed);
    }

    function returnToMenu() {
      scoreboard.style.display = "none";
      canvas.style.display = "none";
      document.getElementById("controls").style.display = "none";
      document.getElementById("menu").style.display = "block";
      updateStageButtons();
    }

    function updateStageButtons() {
      stageButtonsDiv.innerHTML = "";
      for (let i=1; i<=6; i++) {
        let btn = document.createElement("button");
        btn.innerText = "Stage " + i;
        btn.disabled = i > unlockedStages;
        btn.onclick = ()=>startStage(i);
        stageButtonsDiv.appendChild(btn);
      }
    }

    function continueLast() {
      if (unlockedStages >= 1) {
        startStage(unlockedStages);
      } else {
        alert("No saved progress yet! Start from Stage 1.");
      }
    }

    function resetProgress() {
      if (confirm("Are you sure you want to reset progress?")) {
        unlockedStages = 1;
        localStorage.setItem("snakeUnlockedStages", unlockedStages);
        updateStageButtons();
        alert("Progress reset! Back to Stage 1.");
      }
    }

    document.addEventListener("keydown",(e)=>{
      if(e.key==="ArrowLeft"&&direction!=="RIGHT")direction="LEFT";
      else if(e.key==="ArrowUp"&&direction!=="DOWN")direction="UP";
      else if(e.key==="ArrowRight"&&direction!=="LEFT")direction="RIGHT";
      else if(e.key==="ArrowDown"&&direction!=="UP")direction="DOWN";
      else if(e.key==="p"||e.key==="P")togglePause();
    });

    function changeDirection(dir){ 
      if(dir==="LEFT"&&direction!=="RIGHT")direction="LEFT";
      else if(dir==="UP"&&direction!=="DOWN")direction="UP";
      else if(dir==="RIGHT"&&direction!=="LEFT")direction="RIGHT";
      else if(dir==="DOWN"&&direction!=="UP")direction="DOWN";
    }
    function togglePause(){ paused=!paused; }

    // Init
    updateStageButtons();
  </script>
</body>
</html>
